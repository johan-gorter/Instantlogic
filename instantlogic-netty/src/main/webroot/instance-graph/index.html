<!DOCTYPE html>
<html>
  <head>
    <title>Instance Graph</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <script src="zepto.js"></script>
    <script src="/webjars/d3js/3.4.6/d3.js"></script>
    <script src="element.js"></script>
    <script src="fragment.js"></script>
    <script src="channel.js"></script>
    <script src="engine.js"></script>
    <script src="graph.js"></script>
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="instance-graph.css" />
  </head>
  <body class="instance-graph">

    <script>

      var travelerId = "" + Math.floor(Math.random() * 100000000000);
      
      var applicationMatch = /application=([^&]*)/g.exec(location.search);
      if (!applicationMatch) throw new Error('Missing application querystring parameter');
      var caseMatch = /case=([^&]*)/g.exec(location.search);
      if (!caseMatch) throw new Error('Missing case querystring parameter');

      document.title = caseMatch[1] + " - " + applicationMatch[1] + ", instances graph";

      var channel = window.createChannel(applicationMatch[1], caseMatch[1], travelerId);
      var instanceGraph = window.createInstanceGraph($(document.body), "theGraph", channel);
      var engine = window.createEngine(applicationMatch[1], caseMatch[1], travelerId, channel, null, null, {});
      
      
      if (window.location.hash) {
        instanceGraph.showInstance(window.location.hash.substr(1));
	      instanceGraph.expandFirstLevel();
      }
      window.onhashchange = function() {
        instanceGraph.showInstance(window.location.hash.substr(1));
      }
    </script>
  </body>
</html>
